<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Our Anniversary - Enhanced</title>
    <style>
      :root {
        --primary-pink: #e91e63;
        --primary-purple: #9c27b0;
        --card-bg: rgba(255, 255, 255, 0.1);
        --card-border: rgba(255, 255, 255, 0.2);
        --light-text: #ffffff;
        --muted-text: rgba(255, 255, 255, 0.7);
        --shadow-subtle: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-elevated: 0 10px 20px rgba(0, 0, 0, 0.2);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Arial", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
        color: white;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      #hearts-container,
      #petals-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
      }

      .heart,
      .petal {
        position: absolute;
        opacity: 0.7;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .content {
        text-align: center;
        padding: 40px 20px;
      }

      h1 {
        font-size: 3rem;
        margin-bottom: 20px;
        text-shadow: 0 0 10px rgba(233, 30, 99, 0.5);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .intro-text {
        font-size: 1.2rem;
        max-width: 800px;
        margin: 0 auto 40px;
        line-height: 1.6;
        opacity: 0.9;
      }

      .btn {
        padding: 12px 25px;
        background: linear-gradient(
          45deg,
          var(--primary-pink),
          var(--primary-purple)
        );
        border: none;
        border-radius: 50px;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        margin: 10px;
        text-decoration: none;
        display: inline-block;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(233, 30, 99, 0.4);
      }

      .glow-btn {
        box-shadow: 0 0 15px rgba(233, 30, 99, 0.5);
      }

      .feature-buttons {
        margin-top: 40px;
      }

      /* Heartbeat Visualization */
      #heartbeat-container {
        margin: 40px auto;
        text-align: center;
      }

      .heartbeat-visual {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 0 auto 20px;
      }

      .pulse-ring {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 2px solid var(--primary-pink);
        border-radius: 50%;
        animation: pulse-ring 2s infinite;
        opacity: 0;
      }

      .pulse-ring:nth-child(2) {
        animation-delay: 0.5s;
      }

      .pulse-ring:nth-child(3) {
        animation-delay: 1s;
      }

      @keyframes pulse-ring {
        0% {
          transform: scale(0.8);
          opacity: 1;
        }
        100% {
          transform: scale(1.5);
          opacity: 0;
        }
      }

      .heart-icon {
        font-size: 3rem;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: heartbeat 1.5s infinite;
      }

      @keyframes heartbeat {
        0% {
          transform: translate(-50%, -50%) scale(1);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.1);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
        }
      }

      .quote-text {
        font-style: italic;
        font-size: 1.2rem;
        margin-top: 10px;
        opacity: 0.9;
      }

      /* Music Controls */
      #music-controls {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 100;
      }

      #music-toggle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        transition: var(--transition);
      }

      #music-toggle:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Confetti Canvas */
      #confetti-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 999;
      }

      /* Modals */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        box-shadow: var(--shadow-elevated);
        border: 1px solid var(--card-border);
        text-align: center;
      }

      .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.5rem;
        cursor: pointer;
      }

      /* Love Calculator Styles */
      .love-calculator {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 12px;
        margin: 20px 0;
        text-align: center;
        box-shadow: var(--shadow-subtle);
        border: 1px solid var(--card-border);
      }

      .love-inputs {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .love-inputs input {
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid var(--card-border);
        background: rgba(30, 30, 45, 0.7);
        color: var(--light-text);
        font-size: 1rem;
        width: 180px;
        text-align: center;
      }

      .love-result {
        font-size: 1.5rem;
        margin: 20px 0;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .love-meter {
        width: 100%;
        height: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        margin: 15px 0;
        overflow: hidden;
      }

      .love-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary-pink),
          var(--primary-purple)
        );
        border-radius: 10px;
        transition: width 1s ease;
        width: 0%;
      }

      /* Digital Love Notes Styles */
      .notes-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .love-note {
        background: linear-gradient(135deg, #ff9ec6, #c084fc);
        padding: 20px;
        border-radius: 8px;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-subtle);
        position: relative;
        cursor: pointer;
        transition: var(--transition);
      }

      .love-note:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-elevated);
      }

      .note-content {
        flex-grow: 1;
        color: white;
        font-weight: 500;
      }

      .note-date {
        font-size: 0.8rem;
        opacity: 0.8;
        margin-top: 10px;
      }

      .add-note {
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: rgba(255, 255, 255, 0.7);
      }

      .note-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .note-modal-content {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        box-shadow: var(--shadow-elevated);
        border: 1px solid var(--card-border);
      }

      .note-modal textarea {
        width: 100%;
        height: 150px;
        background: rgba(30, 30, 45, 0.7);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 15px;
        color: var(--light-text);
        font-size: 1rem;
        margin: 15px 0;
        resize: vertical;
      }

      /* Virtual Candle Styles */
      .candle-container {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 12px;
        margin: 20px 0;
        text-align: center;
        box-shadow: var(--shadow-subtle);
        border: 1px solid var(--card-border);
      }

      .candle {
        width: 60px;
        height: 120px;
        margin: 0 auto 30px;
        position: relative;
      }

      .candle-body {
        width: 100%;
        height: 100%;
        background: linear-gradient(to right, #f0f0f5, #e0e0e5, #f0f0f5);
        border-radius: 5px;
        position: relative;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .candle-wick {
        width: 4px;
        height: 15px;
        background: #333;
        position: absolute;
        top: -15px;
        left: 50%;
        transform: translateX(-50%);
      }

      .candle-flame {
        width: 20px;
        height: 40px;
        background: linear-gradient(to bottom, #ff9900, #ff5500, #ff0000);
        border-radius: 50% 50% 20% 20%;
        position: absolute;
        top: -55px;
        left: 50%;
        transform: translateX(-50%);
        animation: flicker 2s infinite alternate;
        box-shadow: 0 0 20px #ff5500, 0 0 40px #ff0000;
      }

      @keyframes flicker {
        0%,
        100% {
          transform: translateX(-50%) scale(1);
        }
        25% {
          transform: translateX(-52%) scale(1.05);
        }
        50% {
          transform: translateX(-48%) scale(0.95);
        }
        75% {
          transform: translateX(-51%) scale(1.02);
        }
      }

      .candle-message {
        margin-top: 20px;
        font-style: italic;
        color: var(--muted-text);
      }

      /* Feature Navigation */
      .feature-nav {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .feature-nav-btn {
        padding: 10px 20px;
        background: rgba(30, 30, 45, 0.7);
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        border: 1px solid transparent;
      }

      .feature-nav-btn:hover {
        background: rgba(40, 40, 60, 0.9);
      }

      .feature-nav-btn.active {
        background: var(--primary-pink);
      }

      /* Feature Sections */
      .feature-section {
        display: none;
      }

      .feature-section.active {
        display: block;
        animation: fadeInElegant 0.5s;
      }

      @keyframes fadeInElegant {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Love Memory Match Game Styles - FIXED */
      .memory-game-container {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 12px;
        margin: 20px 0;
        box-shadow: var(--shadow-subtle);
        border: 1px solid var(--card-border);
      }

      .memory-game-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .memory-stats {
        display: flex;
        gap: 15px;
      }

      .stat {
        background: rgba(30, 30, 45, 0.7);
        padding: 8px 15px;
        border-radius: 8px;
        font-size: 0.9rem;
      }

      .memory-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin: 20px 0;
      }

      @media (min-width: 768px) {
        .memory-grid {
          grid-template-columns: repeat(6, 1fr);
        }
      }

      .memory-card {
        aspect-ratio: 1;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        transform-style: preserve-3d;
        position: relative;
        transform: rotateY(0deg); /* Start with back visible */
      }

      .memory-card.flipped {
        transform: rotateY(180deg); /* Flip to show front */
      }

      .memory-card.matched {
        cursor: default;
        opacity: 0.7;
      }

      .memory-card .card-front,
      .memory-card .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        backface-visibility: hidden;
      }

      .memory-card .card-front {
        background: linear-gradient(
          135deg,
          var(--primary-pink),
          var(--primary-purple)
        );
        transform: rotateY(180deg);
        font-size: 2rem;
      }

      .memory-card .card-back {
        background: rgba(30, 30, 45, 0.9);
        font-size: 1.5rem;
      }

      /* Romantic Trivia Game Styles */
      .trivia-game-container {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 12px;
        margin: 20px 0;
        box-shadow: var(--shadow-subtle);
        border: 1px solid var(--card-border);
      }

      .trivia-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .trivia-stats {
        display: flex;
        gap: 15px;
      }

      .trivia-question {
        font-size: 1.2rem;
        margin-bottom: 20px;
        color: var(--light-text);
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .trivia-options {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        margin-bottom: 20px;
      }

      @media (min-width: 768px) {
        .trivia-options {
          grid-template-columns: 1fr 1fr;
        }
      }

      .trivia-option {
        padding: 15px;
        background: rgba(30, 30, 45, 0.7);
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        border: 1px solid transparent;
        text-align: left;
      }

      .trivia-option:hover {
        background: rgba(40, 40, 60, 0.9);
        border-color: var(--primary-pink);
      }

      .trivia-option.selected {
        background: rgba(233, 30, 99, 0.2);
        border-color: var(--primary-pink);
      }

      .trivia-option.correct {
        background: rgba(76, 175, 80, 0.3);
        border-color: #4caf50;
      }

      .trivia-option.incorrect {
        background: rgba(244, 67, 54, 0.3);
        border-color: #f44336;
      }

      .trivia-result {
        text-align: center;
        font-size: 1.3rem;
        margin-top: 20px;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      /* Virtual Rose Modal Styles - NEW */
      #virtual-rose-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .rose-modal-content {
        background: var(--card-bg);
        padding: 40px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        box-shadow: var(--shadow-elevated);
        border: 1px solid var(--card-border);
        text-align: center;
        position: relative;
      }

      .close-rose {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--light-text);
      }

      .close-rose:hover {
        color: var(--primary-pink);
      }

      #rose-3d {
        font-size: 8rem;
        margin: 20px 0;
        animation: rotateRose 5s infinite linear;
        text-shadow: 0 0 20px rgba(233, 30, 99, 0.7);
      }

      @keyframes rotateRose {
        0% {
          transform: rotateY(0deg);
        }
        100% {
          transform: rotateY(360deg);
        }
      }

      .rose-message {
        font-size: 1.3rem;
        margin: 20px 0;
        color: var(--light-text);
        font-style: italic;
      }

      .rose-controls {
        margin-top: 20px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }

        .intro-text {
          font-size: 1rem;
        }

        .love-inputs {
          flex-direction: column;
          align-items: center;
        }

        .feature-nav {
          gap: 5px;
        }

        .feature-nav-btn {
          padding: 8px 15px;
          font-size: 0.9rem;
        }

        .memory-grid {
          grid-template-columns: repeat(3, 1fr);
        }

        #rose-3d {
          font-size: 5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Background animations -->
    <div id="hearts-container"></div>
    <div id="petals-container"></div>

    <!-- Music controls -->
    <div id="music-controls">
      <button id="music-toggle">♪</button>
      <audio id="background-music" loop>
        <source src="assets/music/romantic.mp3" type="audio/mpeg" />
      </audio>
    </div>

    <!-- Confetti canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Main content -->
    <div class="container">
      <div class="content">
        <h1 id="animated-heading">💖 Happy Anniversary My Love 💖</h1>
        <p class="intro-text slide-up">
          Every moment with you feels like a beautiful dream. Today, we
          celebrate another year of our incredible journey together. Through
          laughter, tears, and everything in between, you've been my constant,
          my rock, my everything.
        </p>

        <!-- New Feature Navigation -->
        <div class="feature-nav">
          <div class="feature-nav-btn active" data-feature="love-calculator">
            Love Calculator
          </div>
          <div class="feature-nav-btn" data-feature="memory-game">
            Love Memory Match
          </div>
          <div class="feature-nav-btn" data-feature="trivia-game">
            Romantic Trivia
          </div>
          <div class="feature-nav-btn" data-feature="love-notes">
            Love Notes
          </div>
          <div class="feature-nav-btn" data-feature="candle">
            Virtual Candle
          </div>
        </div>

        <!-- New Features Sections -->

        <!-- Love Calculator -->
        <div id="love-calculator" class="feature-section active">
          <div class="love-calculator">
            <h2>Love Compatibility Calculator</h2>
            <p>Enter your names to see your love percentage!</p>

            <div class="love-inputs">
              <input type="text" id="name1" placeholder="Your Name" />
              <input type="text" id="name2" placeholder="Partner's Name" />
            </div>

            <button id="calculate-love" class="btn glow-btn">
              Calculate Love
            </button>

            <div class="love-result">
              <div class="love-meter">
                <div class="love-fill" id="love-fill"></div>
              </div>
              <div id="love-percentage">0%</div>
              <div id="love-message"></div>
            </div>
          </div>
        </div>

        <!-- Love Memory Match Game -->
        <div id="memory-game" class="feature-section">
          <div class="memory-game-container">
            <div class="memory-game-header">
              <h2>Love Memory Match</h2>
              <div class="memory-stats">
                <div class="stat">Moves: <span id="move-count">0</span></div>
                <div class="stat">
                  Matches: <span id="match-count">0</span>/8
                </div>
                <div class="stat">Time: <span id="time-count">0</span>s</div>
              </div>
            </div>
            <p>Match the romantic symbols to win the game!</p>
            <div class="memory-grid" id="memory-grid">
              <!-- Cards will be populated by JavaScript -->
            </div>
            <button id="reset-memory" class="btn glow-btn">Reset Game</button>
          </div>
        </div>

        <!-- Romantic Trivia Game -->
        <div id="trivia-game" class="feature-section">
          <div class="trivia-game-container">
            <div class="trivia-header">
              <h2>Romantic Trivia</h2>
              <div class="trivia-stats">
                <div class="stat">Score: <span id="score-count">0</span></div>
                <div class="stat">
                  Question: <span id="question-count">1</span>/5
                </div>
              </div>
            </div>
            <div class="trivia-question" id="trivia-question">
              Question will appear here
            </div>
            <div class="trivia-options" id="trivia-options">
              <!-- Options will be populated by JavaScript -->
            </div>
            <button id="next-trivia" class="btn glow-btn" style="display: none">
              Next Question
            </button>
            <div class="trivia-result" id="trivia-result"></div>
          </div>
        </div>

        <!-- Digital Love Notes -->
        <div id="love-notes" class="feature-section">
          <div class="notes-container" id="notes-container">
            <!-- Notes will be populated by JavaScript -->
            <div class="love-note add-note" id="add-note">+</div>
          </div>

          <!-- Note Modal -->
          <div class="note-modal" id="note-modal">
            <div class="note-modal-content">
              <h3>Add a Love Note</h3>
              <textarea
                id="note-text"
                placeholder="Write your love note here..."
              ></textarea>
              <div style="display: flex; gap: 10px">
                <button id="save-note" class="btn glow-btn">Save Note</button>
                <button
                  id="cancel-note"
                  class="btn"
                  style="background: rgba(255, 255, 255, 0.1)"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Virtual Candle -->
        <div id="candle" class="feature-section">
          <div class="candle-container">
            <h2>Light a Candle of Love</h2>
            <div class="candle">
              <div class="candle-body"></div>
              <div class="candle-wick"></div>
              <div class="candle-flame" id="candle-flame"></div>
            </div>
            <button id="toggle-candle" class="btn glow-btn">
              Light Candle
            </button>
            <p class="candle-message" id="candle-message">
              Click to light our candle of eternal love
            </p>
          </div>
        </div>

        <!-- Existing Heartbeat Visualization -->
        <div id="heartbeat-container">
          <div class="heartbeat-visual">
            <div class="pulse-ring"></div>
            <div class="pulse-ring"></div>
            <div class="pulse-ring"></div>
            <div class="heart-icon">💖</div>
          </div>
          <div id="romantic-quote" class="quote-text">
            "Your love makes my heart beat faster"
          </div>
        </div>

        <div class="feature-buttons">
          <a href="gallery.html" class="btn glow-btn">Start Our Journey 💌</a>
          <button id="ai-letter-btn" class="btn glow-btn">
            AI Love Letter ✨
          </button>
          <button id="virtual-rose-btn" class="btn glow-btn">
            Send Virtual Rose 🌹
          </button>
        </div>
      </div>
    </div>

    <!-- Existing Modals -->
    <div id="ai-letter-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>AI-Generated Love Letter</h2>
        <div id="ai-letter-content">
          <p>Click the button below to generate a beautiful love letter!</p>
        </div>
        <button id="generate-letter" class="btn glow-btn">
          Generate Love Letter
        </button>
      </div>
    </div>

    <!-- Virtual Rose Modal - FIXED -->
    <div id="virtual-rose-container" class="modal">
      <div class="rose-modal-content">
        <span class="close-rose">&times;</span>
        <div id="rose-3d">🌹</div>
        <div class="rose-message">
          This virtual rose symbolizes my eternal love for you!
        </div>
        <div class="rose-controls">
          <button id="send-rose" class="btn glow-btn">
            Send with Love Message
          </button>
        </div>
      </div>
    </div>

    <script>
      // Feature Navigation
      document.addEventListener("DOMContentLoaded", function () {
        const featureNavBtns = document.querySelectorAll(".feature-nav-btn");
        const featureSections = document.querySelectorAll(".feature-section");

        featureNavBtns.forEach((btn) => {
          btn.addEventListener("click", function () {
            const feature = this.getAttribute("data-feature");

            // Update active button
            featureNavBtns.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");

            // Show corresponding section
            featureSections.forEach((section) => {
              section.classList.remove("active");
              if (section.id === feature) {
                section.classList.add("active");
              }
            });
          });
        });

        // Initialize all features
        initLoveCalculator();
        initMemoryGame();
        initTriviaGame();
        initLoveNotes();
        initVirtualCandle();
        initBackgroundEffects();
        initModals();
      });

      // Background Effects
      function initBackgroundEffects() {
        // Create floating hearts
        const heartsContainer = document.getElementById("hearts-container");
        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            createHeart();
          }, i * 500);
        }

        // Create falling petals
        const petalsContainer = document.getElementById("petals-container");
        for (let i = 0; i < 15; i++) {
          setTimeout(() => {
            createPetal();
          }, i * 700);
        }

        // Music controls
        const musicToggle = document.getElementById("music-toggle");
        const backgroundMusic = document.getElementById("background-music");

        musicToggle.addEventListener("click", function () {
          if (backgroundMusic.paused) {
            backgroundMusic.play();
            musicToggle.textContent = "♪";
          } else {
            backgroundMusic.pause();
            musicToggle.textContent = "♪";
          }
        });
      }

      function createHeart() {
        const heart = document.createElement("div");
        heart.classList.add("heart");
        heart.innerHTML = "❤";
        heart.style.left = Math.random() * 100 + "vw";
        heart.style.fontSize = Math.random() * 20 + 10 + "px";
        heart.style.animationDuration = Math.random() * 3 + 3 + "s";

        document.getElementById("hearts-container").appendChild(heart);

        // Remove heart after animation completes
        setTimeout(() => {
          heart.remove();
        }, 6000);

        // Create new heart periodically
        setTimeout(createHeart, Math.random() * 3000 + 2000);
      }

      function createPetal() {
        const petal = document.createElement("div");
        petal.classList.add("petal");
        petal.innerHTML = "🌸";
        petal.style.left = Math.random() * 100 + "vw";
        petal.style.fontSize = Math.random() * 15 + 10 + "px";
        petal.style.animation = `fall ${
          Math.random() * 5 + 5
        }s linear forwards`;

        document.getElementById("petals-container").appendChild(petal);

        // Remove petal after animation completes
        setTimeout(() => {
          petal.remove();
        }, 10000);

        // Create new petal periodically
        setTimeout(createPetal, Math.random() * 4000 + 3000);
      }

      // Love Calculator - FIXED to properly handle empty inputs on page load
      function initLoveCalculator() {
        const calculateBtn = document.getElementById("calculate-love");
        const name1Input = document.getElementById("name1");
        const name2Input = document.getElementById("name2");
        const loveFill = document.getElementById("love-fill");
        const lovePercentage = document.getElementById("love-percentage");
        const loveMessage = document.getElementById("love-message");

        // Clear inputs on page load
        name1Input.value = "";
        name2Input.value = "";
        loveFill.style.width = "0%";
        lovePercentage.textContent = "0%";
        loveMessage.textContent =
          "Enter your names to see your love percentage!";

        calculateBtn.addEventListener("click", function () {
          const name1 = name1Input.value.trim();
          const name2 = name2Input.value.trim();

          // Use default values if inputs are empty
          const displayName1 = name1 || "You";
          const displayName2 = name2 || "Your Partner";

          // Only save to localStorage if both names have actual content
          if (name1 && name2) {
            const results = { name1, name2 };
            localStorage.setItem(
              "loveCalculatorResults",
              JSON.stringify(results)
            );
          } else {
            // Clear localStorage if names are empty
            localStorage.removeItem("loveCalculatorResults");
          }

          updateLoveResult(displayName1, displayName2);
        });

        function updateLoveResult(name1, name2) {
          // Don't calculate if using default placeholder names
          if (name1 === "You" && name2 === "Your Partner") {
            loveFill.style.width = "0%";
            lovePercentage.textContent = "0%";
            loveMessage.textContent =
              "Enter your names to see your love percentage!";
            return;
          }

          // Deterministic algorithm based on names
          const calculatedPercentage = calculateLovePercentage(name1, name2);

          loveFill.style.width = `${calculatedPercentage}%`;
          lovePercentage.textContent = `${calculatedPercentage}%`;

          // Generate a romantic message based on percentage
          let message = "";
          if (calculatedPercentage >= 90) {
            message = `Wow! ${name1} and ${name2} are a perfect match! Your love is truly special.`;
          } else if (calculatedPercentage >= 80) {
            message = `Amazing! ${name1} and ${name2} have a strong connection that will last forever.`;
          } else if (calculatedPercentage >= 70) {
            message = `Great! ${name1} and ${name2} have a beautiful relationship full of love.`;
          } else {
            message = `Good! ${name1} and ${name2} have a loving bond that will grow stronger.`;
          }

          loveMessage.textContent = message;
        }

        function calculateLovePercentage(name1, name2) {
          // Create a consistent hash from the names
          const combined = (name1 + name2).toLowerCase().replace(/\s/g, "");
          let hash = 0;

          for (let i = 0; i < combined.length; i++) {
            const char = combined.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // Convert to 32-bit integer
          }

          // Use the hash to generate a consistent percentage between 70-100%
          const percentage = 70 + (Math.abs(hash) % 31);
          return percentage;
        }
      }

      // Memory Game - FIXED with confetti on completion
      function initMemoryGame() {
        const memoryGrid = document.getElementById("memory-grid");
        const moveCount = document.getElementById("move-count");
        const matchCount = document.getElementById("match-count");
        const timeCount = document.getElementById("time-count");
        const resetBtn = document.getElementById("reset-memory");

        let moves = 0;
        let matches = 0;
        let timer = 0;
        let timerInterval;
        let flippedCards = [];
        let canFlip = true;

        // Romantic symbols for the game
        const symbols = ["💖", "💕", "💘", "💝", "💓", "💗", "💞", "💟"];
        const gameCards = [...symbols, ...symbols]; // Duplicate for matching

        // Shuffle function
        function shuffle(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
          return array;
        }

        // Initialize game
        function initGame() {
          // Clear the grid
          memoryGrid.innerHTML = "";
          moves = 0;
          matches = 0;
          timer = 0;
          flippedCards = [];
          canFlip = true;

          moveCount.textContent = moves;
          matchCount.textContent = matches;
          timeCount.textContent = timer;

          // Stop any existing timer
          if (timerInterval) clearInterval(timerInterval);

          // Start timer
          timerInterval = setInterval(() => {
            timer++;
            timeCount.textContent = timer;
          }, 1000);

          // Shuffle and create cards
          const shuffledCards = shuffle([...gameCards]);

          shuffledCards.forEach((symbol, index) => {
            const card = document.createElement("div");
            card.classList.add("memory-card");
            card.dataset.symbol = symbol;
            card.dataset.index = index;

            const cardFront = document.createElement("div");
            cardFront.classList.add("card-front");
            cardFront.textContent = symbol;

            const cardBack = document.createElement("div");
            cardBack.classList.add("card-back");
            cardBack.textContent = "?";

            card.appendChild(cardFront);
            card.appendChild(cardBack);

            card.addEventListener("click", flipCard);
            memoryGrid.appendChild(card);
          });
        }

        // Flip card function
        function flipCard() {
          if (!canFlip) return;
          if (this.classList.contains("flipped")) return;
          if (flippedCards.length >= 2) return;

          this.classList.add("flipped");
          flippedCards.push(this);

          if (flippedCards.length === 2) {
            canFlip = false;
            moves++;
            moveCount.textContent = moves;

            checkForMatch();
          }
        }

        // Check for match
        function checkForMatch() {
          const [card1, card2] = flippedCards;

          if (card1.dataset.symbol === card2.dataset.symbol) {
            // Match found
            card1.classList.add("matched");
            card2.classList.add("matched");
            matches++;
            matchCount.textContent = matches;

            flippedCards = [];
            canFlip = true;

            // Check for game completion
            if (matches === symbols.length) {
              clearInterval(timerInterval);
              setTimeout(() => {
                triggerConfetti();
                alert("Congratulations! You've matched all the symbols!");
              }, 500);
            }
          } else {
            // No match
            setTimeout(() => {
              card1.classList.remove("flipped");
              card2.classList.remove("flipped");
              flippedCards = [];
              canFlip = true;
            }, 1000);
          }
        }

        // Reset game
        resetBtn.addEventListener("click", initGame);

        // Initialize the game on page load
        initGame();
      }

      // Trivia Game - FIXED with confetti on completion
      function initTriviaGame() {
        const triviaQuestion = document.getElementById("trivia-question");
        const triviaOptions = document.getElementById("trivia-options");
        const scoreCount = document.getElementById("score-count");
        const questionCount = document.getElementById("question-count");
        const nextBtn = document.getElementById("next-trivia");
        const triviaResult = document.getElementById("trivia-result");

        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;

        // Romantic trivia questions
        const questions = [
          {
            question: "Which flower is most commonly associated with romance?",
            options: ["Tulip", "Rose", "Daisy", "Sunflower"],
            correct: 1,
          },
          {
            question: "What is the traditional gift for a 1st anniversary?",
            options: ["Paper", "Gold", "Silver", "Diamond"],
            correct: 0,
          },
          {
            question: "Which of these is a symbol of eternal love?",
            options: ["Infinity symbol", "Anchor", "Key", "Star"],
            correct: 0,
          },
          {
            question: "What is the most popular month for weddings?",
            options: ["June", "August", "September", "October"],
            correct: 0,
          },
          {
            question: "Which gemstone is associated with love and passion?",
            options: ["Ruby", "Sapphire", "Emerald", "Amethyst"],
            correct: 0,
          },
        ];

        // Initialize trivia game
        function initTrivia() {
          currentQuestion = 0;
          score = 0;
          selectedOption = null;

          scoreCount.textContent = score;
          questionCount.textContent = currentQuestion + 1;

          nextBtn.style.display = "none";
          triviaResult.textContent = "";

          loadQuestion();
        }

        // Load question
        function loadQuestion() {
          const question = questions[currentQuestion];
          triviaQuestion.textContent = question.question;

          // Clear options
          triviaOptions.innerHTML = "";

          // Create options
          question.options.forEach((option, index) => {
            const optionElement = document.createElement("div");
            optionElement.classList.add("trivia-option");
            optionElement.textContent = option;
            optionElement.dataset.index = index;

            optionElement.addEventListener("click", selectOption);
            triviaOptions.appendChild(optionElement);
          });
        }

        // Select option
        function selectOption() {
          if (selectedOption !== null) return;

          selectedOption = parseInt(this.dataset.index);
          this.classList.add("selected");

          // Check answer
          const isCorrect =
            selectedOption === questions[currentQuestion].correct;

          if (isCorrect) {
            score++;
            scoreCount.textContent = score;
            this.classList.add("correct");
          } else {
            this.classList.add("incorrect");
            // Highlight correct answer
            triviaOptions.children[
              questions[currentQuestion].correct
            ].classList.add("correct");
          }

          // Show next button
          nextBtn.style.display = "block";
        }

        // Next question
        nextBtn.addEventListener("click", function () {
          currentQuestion++;

          if (currentQuestion < questions.length) {
            questionCount.textContent = currentQuestion + 1;
            selectedOption = null;
            nextBtn.style.display = "none";
            triviaResult.textContent = "";
            loadQuestion();
          } else {
            // Game completed
            triviaQuestion.textContent = "Quiz Completed!";
            triviaOptions.innerHTML = "";
            nextBtn.style.display = "none";

            // Show results
            const percentage = (score / questions.length) * 100;
            triviaResult.innerHTML = `
              <p>Your Score: ${score}/${questions.length}</p>
              <p>${
                percentage >= 80
                  ? "Excellent! You're a romantic expert!"
                  : percentage >= 60
                  ? "Great job! You know your romance!"
                  : "Good effort! Keep learning about love!"
              }</p>
            `;

            // Trigger confetti for good scores
            if (percentage >= 60) {
              triggerConfetti();
            }
          }
        });

        // Initialize the trivia game
        initTrivia();
      }

      // Love Notes - FIXED with localStorage
      function initLoveNotes() {
        const notesContainer = document.getElementById("notes-container");
        const addNoteBtn = document.getElementById("add-note");
        const noteModal = document.getElementById("note-modal");
        const saveNoteBtn = document.getElementById("save-note");
        const cancelNoteBtn = document.getElementById("cancel-note");
        const noteText = document.getElementById("note-text");

        // Load notes from localStorage
        let notes = JSON.parse(localStorage.getItem("loveNotes")) || [];

        // Display notes
        function displayNotes() {
          // Clear container except for add button
          notesContainer.innerHTML = "";

          notes.forEach((note, index) => {
            const noteElement = document.createElement("div");
            noteElement.classList.add("love-note");
            noteElement.innerHTML = `
              <div class="note-content">${note.text}</div>
              <div class="note-date">${note.date}</div>
              <button class="delete-note" data-index="${index}">×</button>
            `;

            // Add delete functionality
            const deleteBtn = noteElement.querySelector(".delete-note");
            deleteBtn.addEventListener("click", function (e) {
              e.stopPropagation();
              deleteNote(index);
            });

            // Add edit functionality on click
            noteElement.addEventListener("click", function () {
              editNote(index);
            });

            notesContainer.appendChild(noteElement);
          });

          // Add the add button at the end
          notesContainer.appendChild(addNoteBtn);
        }

        // Add new note
        addNoteBtn.addEventListener("click", function () {
          noteText.value = "";
          noteModal.style.display = "flex";
        });

        // Save note
        saveNoteBtn.addEventListener("click", function () {
          const text = noteText.value.trim();
          if (text) {
            const newNote = {
              text: text,
              date: new Date().toLocaleDateString(),
            };

            // Check if we're editing an existing note
            const editingIndex = saveNoteBtn.dataset.editingIndex;
            if (editingIndex !== undefined) {
              notes[editingIndex] = newNote;
              delete saveNoteBtn.dataset.editingIndex;
            } else {
              notes.push(newNote);
            }

            // Save to localStorage
            localStorage.setItem("loveNotes", JSON.stringify(notes));

            // Update display and close modal
            displayNotes();
            noteModal.style.display = "none";
          }
        });

        // Cancel note
        cancelNoteBtn.addEventListener("click", function () {
          noteModal.style.display = "none";
          delete saveNoteBtn.dataset.editingIndex;
        });

        // Delete note
        function deleteNote(index) {
          if (confirm("Are you sure you want to delete this note?")) {
            notes.splice(index, 1);
            localStorage.setItem("loveNotes", JSON.stringify(notes));
            displayNotes();
          }
        }

        // Edit note
        function editNote(index) {
          const note = notes[index];
          noteText.value = note.text;
          saveNoteBtn.dataset.editingIndex = index;
          noteModal.style.display = "flex";
        }

        // Initialize notes display
        displayNotes();
      }

      // Virtual Candle
      function initVirtualCandle() {
        const toggleCandleBtn = document.getElementById("toggle-candle");
        const candleFlame = document.getElementById("candle-flame");
        const candleMessage = document.getElementById("candle-message");

        let isLit = false;

        // Load candle state from localStorage
        const savedState = localStorage.getItem("candleLit");
        if (savedState === "true") {
          isLit = true;
          candleFlame.style.display = "block";
          toggleCandleBtn.textContent = "Blow Out Candle";
          candleMessage.textContent = "Our love burns bright and eternal";
        }

        toggleCandleBtn.addEventListener("click", function () {
          isLit = !isLit;

          if (isLit) {
            candleFlame.style.display = "block";
            toggleCandleBtn.textContent = "Blow Out Candle";
            candleMessage.textContent = "Our love burns bright and eternal";
          } else {
            candleFlame.style.display = "none";
            toggleCandleBtn.textContent = "Light Candle";
            candleMessage.textContent =
              "Click to light our candle of eternal love";
          }

          // Save state to localStorage
          localStorage.setItem("candleLit", isLit.toString());
        });
      }

      // Modals
      function initModals() {
        // AI Love Letter Modal
        const aiLetterBtn = document.getElementById("ai-letter-btn");
        const aiLetterModal = document.getElementById("ai-letter-modal");
        const closeModal = document.querySelector(".close");
        const generateLetterBtn = document.getElementById("generate-letter");
        const aiLetterContent = document.getElementById("ai-letter-content");

        aiLetterBtn.addEventListener("click", function () {
          aiLetterModal.style.display = "flex";
        });

        closeModal.addEventListener("click", function () {
          aiLetterModal.style.display = "none";
        });

        generateLetterBtn.addEventListener("click", function () {
          // Simple AI love letter generation
          const letters = [
            "My dearest love, every moment with you feels like a beautiful dream. Your smile lights up my world and your laughter is the sweetest melody to my ears. I cherish every second we spend together and look forward to a lifetime of creating beautiful memories with you.",

            "To the one who holds my heart, being with you has shown me what true love means. Your kindness, your passion, and your unwavering support make me a better person. I fall more in love with you each day, and I'm grateful for every moment we share.",

            "My beloved, from the moment we met, I knew there was something special about you. Our journey together has been filled with laughter, joy, and an unbreakable bond. You are my everything, and I promise to love you today, tomorrow, and forever.",
          ];

          const randomLetter =
            letters[Math.floor(Math.random() * letters.length)];
          aiLetterContent.innerHTML = `<p style="font-style: italic; line-height: 1.6;">${randomLetter}</p>`;
        });

        // Virtual Rose Modal
        const virtualRoseBtn = document.getElementById("virtual-rose-btn");
        const virtualRoseContainer = document.getElementById(
          "virtual-rose-container"
        );
        const closeRose = document.querySelector(".close-rose");
        const sendRoseBtn = document.getElementById("send-rose");

        virtualRoseBtn.addEventListener("click", function () {
          virtualRoseContainer.style.display = "flex";
        });

        closeRose.addEventListener("click", function () {
          virtualRoseContainer.style.display = "none";
        });

        sendRoseBtn.addEventListener("click", function () {
          alert("🌹 Your virtual rose has been sent with a loving message! 🌹");
          virtualRoseContainer.style.display = "none";
          triggerConfetti();
        });

        // Close modals when clicking outside
        window.addEventListener("click", function (event) {
          if (event.target === aiLetterModal) {
            aiLetterModal.style.display = "none";
          }
          if (event.target === virtualRoseContainer) {
            virtualRoseContainer.style.display = "none";
          }
        });
      }

      // Confetti Effect - NEW
      function triggerConfetti() {
        const canvas = document.getElementById("confetti-canvas");
        const ctx = canvas.getContext("2d");

        // Set canvas size
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const confettiPieces = [];
        const confettiColors = [
          "#f44336",
          "#e91e63",
          "#9c27b0",
          "#673ab7",
          "#3f51b5",
          "#2196f3",
          "#03a9f4",
          "#00bcd4",
          "#009688",
          "#4CAF50",
        ];

        // Create confetti pieces
        for (let i = 0; i < 150; i++) {
          confettiPieces.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height - canvas.height,
            size: Math.random() * 10 + 5,
            color:
              confettiColors[Math.floor(Math.random() * confettiColors.length)],
            speed: Math.random() * 3 + 2,
            rotation: Math.random() * 360,
            rotationSpeed: Math.random() * 10 - 5,
          });
        }

        // Animation function
        function animateConfetti() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          let activePieces = 0;

          confettiPieces.forEach((piece) => {
            piece.y += piece.speed;
            piece.x += Math.sin(piece.y * 0.01) * 0.5; // Slight horizontal movement
            piece.rotation += piece.rotationSpeed;

            if (piece.y < canvas.height) {
              activePieces++;

              ctx.save();
              ctx.translate(piece.x, piece.y);
              ctx.rotate((piece.rotation * Math.PI) / 180);

              ctx.fillStyle = piece.color;
              ctx.fillRect(
                -piece.size / 2,
                -piece.size / 2,
                piece.size,
                piece.size
              );

              ctx.restore();
            }
          });

          if (activePieces > 0) {
            requestAnimationFrame(animateConfetti);
          } else {
            // Clear canvas when animation is complete
            ctx.clearRect(0, 0, canvas.width, canvas.height);
          }
        }

        animateConfetti();
      }

      // Add CSS for confetti animation
      const confettiStyles = document.createElement("style");
      confettiStyles.textContent = `
        @keyframes fall {
          to {
            transform: translateY(100vh);
          }
        }
      `;
      document.head.appendChild(confettiStyles);
    </script>
  </body>
</html>
